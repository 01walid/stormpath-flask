<html>
  <head>
    <title>Create an Account</title>
  </head>
  <body>
    {% if config['STORMPATH_ENABLE_FACEBOOK'] %}
      <script>
        function redirectIfLoginSuccessful() {
          FB.getLoginStatus(function(response) {
            if (response.status === 'connected') {
              window.location.replace('{{ config['STORMPATH_REDIRECT_URL'] }}');
            }
          });
        }

        window.fbAsyncInit = function() {
          FB.init({
            appId      : '{{ config['STORMPATH_SOCIAL']['FACEBOOK']['app_id'] }}',
            cookie     : true,
            xfbml      : true,
            version    : 'v2.0'
          });
        };

        (function(d, s, id){
           var js, fjs = d.getElementsByTagName(s)[0];
           if (d.getElementById(id)) {return;}
           js = d.createElement(s); js.id = id;
           js.src = "//connect.facebook.net/en_US/sdk.js";
           fjs.parentNode.insertBefore(js, fjs);
         }(document, 'script', 'facebook-jssdk'));
      </script>
      <fb:login-button scope="email" onlogin="redirectIfLoginSuccessful();">
      </fb:login-button>
    {% endif %}

    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <ul class="flashes">
          {% for message in messages %}
            <li>{{ message }}</li>
          {% endfor %}
        </ul>
      {% endif %}
    {% endwith %}

    <form action="" method="post">
      {{ form.hidden_tag() }}
      <fieldset>
        <legend>Create an Account</legend>
        {% if config['STORMPATH_ENABLE_USERNAME'] %}
          {{ form.username.label }}
          {% if config['STORMPATH_REQUIRE_USERNAME'] %}
            {{ form.username(placeholder='Username', required='true') }}
          {% else %}
            {{ form.username(placeholder='Username') }}
          {% endif %}
        {% endif %}
        {% if config['STORMPATH_ENABLE_GIVEN_NAME'] %}
          {{ form.given_name.label }}
          {% if config['STORMPATH_REQUIRE_GIVEN_NAME'] %}
            {{ form.given_name(placeholder='First Name', required='true') }}
          {% else %}
            {{ form.given_name(placeholder='First Name') }}
          {% endif %}
        {% endif %}
        {% if config['STORMPATH_ENABLE_MIDDLE_NAME'] %}
          {{ form.middle_name.label }}
          {% if config['STORMPATH_REQUIRE_MIDDLE_NAME'] %}
            {{ form.middle_name(placeholder='Middle Name', required='true') }}
          {% else %}
            {{ form.middle_name(placeholder='Middle Name') }}
          {% endif %}
        {% endif %}
        {% if config['STORMPATH_ENABLE_SURNAME'] %}
          {{ form.surname.label }}
          {% if config['STORMPATH_REQUIRE_MIDDLE_NAME'] %}
            {{ form.surname(placeholder='Last Name', required='true') }}
          {% else %}
            {{ form.surname(placeholder='Last Name') }}
          {% endif %}
        {% endif %}
        {{ form.email.label }}
        {{ form.email(placeholder='Email', required='true', type="email") }}
        {{ form.password.label }}
        {{ form.password(placeholder='Password', required='true') }}
        <input type="submit" name="Register">
      </fieldset>
    </form>
  </body>
</html>
