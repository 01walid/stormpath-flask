<html>
  <head>
    <title>Login</title>
  </head>
  <body>
    {% if config['STORMPATH_ENABLE_GOOGLE'] %}
      <button id="google" onclick="googleLogin()">Log in With Google</button>
      <script>
        // Log a user in with Google OAuth.
        function googleLogin() {
          window.location.replace('https://accounts.google.com/o/oauth2/auth?response_type=code&client_id={{ config['STORMPATH_SOCIAL']['GOOGLE']['client_id'] }}&scope=email&include_granted_scopes=true&redirect_uri={{ (request.url_root[:-1] + config['STORMPATH_GOOGLE_LOGIN_URL'])|urlencode }}');
        }
      </script>
    {% endif %}

    {% if config['STORMPATH_ENABLE_FACEBOOK'] %}
      <script>
        function redirectIfLoginSuccessful() {
          FB.getLoginStatus(function(response) {
            if (response.status === 'connected') {
              var queryStr = window.location.search.replace('?', '');
              if (queryStr) {
                window.location.replace('{{ config['STORMPATH_FACEBOOK_LOGIN_URL'] }}?' + queryStr);
              } else {
                window.location.replace('{{ config['STORMPATH_FACEBOOK_LOGIN_URL'] }}');
              }
            }
          });
        }

        window.fbAsyncInit = function() {
          FB.init({
            appId      : '{{ config['STORMPATH_SOCIAL']['FACEBOOK']['app_id'] }}',
            cookie     : true,
            xfbml      : true,
            version    : 'v2.0'
          });
        };

        (function(d, s, id){
           var js, fjs = d.getElementsByTagName(s)[0];
           if (d.getElementById(id)) {return;}
           js = d.createElement(s); js.id = id;
           js.src = "//connect.facebook.net/en_US/sdk.js";
           fjs.parentNode.insertBefore(js, fjs);
         }(document, 'script', 'facebook-jssdk'));
      </script>
      <fb:login-button scope="email" onlogin="redirectIfLoginSuccessful();">
      </fb:login-button>
    {% endif %}

    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <ul class="flashes">
          {% for message in messages %}
            <li>{{ message }}</li>
          {% endfor %}
        </ul>
      {% endif %}
    {% endwith %}
    <form action="" method="post">
      {{ form.hidden_tag() }}
      <fieldset>
        <legend>Login</legend>
        {% if config['STORMPATH_ENABLE_USERNAME'] %}
          <label for="login">Username or Email</label>
          {{ form.login(placeholder="Username or Email") }}
        {% else %}
          <label for="login">Email</label>
          {{ form.login(placeholder="Email") }}
        {% endif %}
        {{ form.password.label }}
        {{ form.password(placeholder='Password', required='true') }}
        <input type="submit" name="Login">
      </fieldset>
    </form>
  </body>
</html>
